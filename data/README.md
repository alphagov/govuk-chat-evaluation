# GOV.UK Chat Evaluation

## Evaluation data sets

This directory should contain input data for evaluation. The contents are purposefully git ignored as this data can be sensitive.

We have the data stored on [Google Drive](https://docs.google.com/document/d/1tfgY8-5hCZDqw5zYAVpgYgB-VtjCKlzk1l1HMdOVV8U/edit?tab=t.0#heading=h.9awg20g181xc) which AI Team members can access. It is expected that files from Google Drive will be saved to this directory to run an evaluation.

## Expected format of data sets

When creating new evaluation data sets or running evaluation ad-hoc, each data set has to follow a particular format.

All data sets must be provided as a .jsonl file, where **each line** represents a single case to be evaluated formatted as a JSON object, i.e. each file is a list of JSON objects. 

The evaluation pipeline caters to two cases for all evaluation tasks:
* setting 'generate: false' in the config file - the actual response by the LLM has already been generated and is in the data set  
* setting 'generate: true' in the config file - the actual response by the LLM is generated while running the evaluation pipeline

Below we will define the fields each evaluation task expects and give examples for correctly formatted 'generate: true' and 'generate: false' JSON objects.

In all cases: additional fields beyond those listed are permitted but will be ignored during evaluation.

### jailbreak_guardrails

| Field | Type | Description |
|-------|------|-------------|
| `question` | `string` | The question or prompt to evaluate. |
| `expected_outcome` | `bool` | Expected classification outcome. `false` = "no-jailbreak"; `true` = "jailbreak". |
| `actual_outcome` | `bool` | The component's actual classification outcome. `false` = "no-jailbreak"; `true` = "jailbreak". |


#### Example: 'generate: true'

```json
{
    "question": "Example question to evaluate",
    "expected_outcome": true
}
```

#### Example: 'generate: false'

```json
{
    "question": "Example question to evaluate",
    "expected_outcome": true,
    "actual_outcome": false
}
```

### rag_answers

| Field | Type | Description |
|-------|------|-------------|
| `question` | `string` | The question or prompt to be evaluated. |
| `ideal_answer` | `string` | The ideal/ground-truth answer. |
| `llm_answer` | `string` | The answer generated by the LLM. |
| `structured_contexts` | `list[object]` | A list of context chunks used for answering the question. Each element is an object as described below. |

`structured_contexts` object fields ( = chunk as defined in OpenSearch):

| Field | Type | Description |
|-------|------|-------------|
| `exact_path` | `string` | Exact path or URI to the source content chunk. |
| `title` | `string` | Title of the page or source document. |
| `heading_hierarchy` | `list[string]` or `null` | Hierarchical headings leading to this chunk. |
| `description` | `string` | Short description or summary of the source page. |
| `html_content` | `string` | Raw HTML content of the chunk. |

#### config: "generate: true"

For:
* relevance 
* faithfulness  
* context_relevancy 
* coherence


```json
{
  "question": "Example question to evaluate"
}
```

For:
* factual_correctness

```json
{
  "question": "Example question to be evaluate",
  "ideal_answer": "Example ideal/ground-truth answer"
}
```

#### config: "generate: false"

For:
* relevance 
* faithfulness  
* context_relevancy 
* coherence

```json
{
  "question": "Example question to be evaluate",
  "llm_answer": "Example answer produced by Chat",
  "structured_contexts": [
    {
      "exact_path": "/example-exact-path-to#chunk",
      "title": "Example title of the page",
      "heading_hierarchy": ["Heading1", "Heading2"],
      "description": "Example description of the page",
      "html_content": "Example html_content of the chunk"
    }
  ]
}
```

For:
* factual_correctness

```json
{
  "question": "Example question to be evaluate",
  "ideal_answer": "Example ideal/ground-truth answer",
  "llm_answer": "Example answer produced by Chat",
  "structured_contexts": [
    {
      "exact_path": "/example-exact-path-to#chunk",
      "title": "Example title of the page",
      "heading_hierarchy": ["Heading1", "Heading2"],
      "description": "Example description of the page",
      "html_content": "Example html_content of the chunk"
    }
  ]
}
```


